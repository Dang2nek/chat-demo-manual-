<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chat E2E</title>
<style>
#chat{height:300px;overflow:auto;border:1px solid #ccc;padding:5px;}
</style>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
</head>
<body>
<h3>Chat E2E</h3>
<div>
    Socket ID: <span id="socketId"></span>
</div>
<div id="chat"></div>
<input type="text" id="msgInput" placeholder="Message">
<input type="text" id="passphraseInput" placeholder="Passphrase">
<button id="sendBtn">Send</button>

<script>
const socket = io();

socket.on('socketId', id=>{
    document.getElementById('socketId').textContent = id;
});

// Receive messages
socket.on('chatMessage', ({from,msg})=>{
    const el = document.createElement('div');
    el.textContent = from + ": " + msg;
    document.getElementById('chat').appendChild(el);
});

// Delete notice
socket.on('deleteNotice', ({from,msg})=>{
    const el = document.createElement('div');
    el.textContent = "[Message from "+from+" deleted]";
    document.getElementById('chat').appendChild(el);
});

// Send message
document.getElementById('sendBtn').addEventListener('click', ()=>{
    const msg = document.getElementById('msgInput').value;
    const passphrase = document.getElementById('passphraseInput').value;
    if(!msg || !passphrase) return alert("Enter msg + passphrase");
    socket.emit('chatMessage',{from:"Me", msg, passphrase});
    document.getElementById('msgInput').value = '';
});

// Load previous messages
window.onload = ()=>{
    const passphrase = prompt("Enter your passphrase to decrypt old messages:");
    socket.emit('loadMessages',{passphrase});
};
</script>
</body>
</html>
