<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chat App with Login</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #login, #chatroom { max-width: 400px; margin: auto; }
    #chat { list-style: none; margin: 0; padding: 10px; height: 300px; overflow-y: scroll; border: 1px solid #ccc; }
    #chat li { margin-bottom: 5px; }
    form { display: flex; margin-top: 10px; }
    input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { padding: 10px; border: none; background: #007bff; color: #fff; cursor: pointer; }
    #chatroom { display: none; }
  </style>
</head>
<body>
  <h2>ðŸ’¬ Chat App</h2>

  <!-- MÃ n hÃ¬nh Ä‘Äƒng nháº­p -->
  <div id="login">
    <input id="username" placeholder="Nháº­p tÃªn cá»§a báº¡n..." />
    <button id="loginBtn">VÃ o phÃ²ng chat</button>
  </div>

  <!-- PhÃ²ng chat -->
  <div id="chatroom">
    <ul id="chat"></ul>
    <form id="form">
      <input id="input" autocomplete="off" placeholder="Nháº­p tin nháº¯n..." />
      <button>Gá»­i</button>
    </form>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const loginDiv = document.getElementById("login");
    const chatroomDiv = document.getElementById("chatroom");
    const loginBtn = document.getElementById("loginBtn");
    const usernameInput = document.getElementById("username");
    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const input = document.getElementById("input");

    let username = "";

    loginBtn.addEventListener("click", () => {
      username = usernameInput.value.trim();
      if (username) {
        socket.emit("set username", username);
        loginDiv.style.display = "none";
        chatroomDiv.style.display = "block";
      }
    });

    socket.on("load messages", (msgs) => {
      msgs.forEach((msg) => addMessage(msg.user, msg.text));
    });

    socket.on("chat message", (msg) => {
      addMessage(msg.user, msg.text);
    });

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (input.value) {
        socket.emit("chat message", input.value);
        input.value = "";
      }
    });

    function addMessage(user, text) {
      const li = document.createElement("li");
      li.textContent = `${user}: ${text}`;
      chat.appendChild(li);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>
